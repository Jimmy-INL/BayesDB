---
title: Examples
tagline: 
layout: examples
---
# Dartmouth Atlas of Health
+
## Recording the cost structure, capacity and quality of care of US hospitals.

One of the main concerns in American health care is addressing *unwarranted variations* in quality: a disparity between the cost and outcomes of care. The cost-care disparity is well-documented mainly as a result of the Dartmouth Atlas of Health Care, a freely available dataset which

>...uses Medicare data to provide information and analysis about national, regional, and local markets, as well as hospitals and their affiliated physicians

Where initially, these findings were produced and reported by teams of researchers after months of work, we shall use BayesDB to verify these results in a few commands.

### Unwarranted variations in aggregate

First, we create a btable and load in pre-computed models,

    CREATE BTABLE dha FROM dha.csv;
    LOAD MODELS dha_models.pkl.gz INTO dha;

The first thing to do is to is get a general sense of the data by creating a column dependence probability matrix in which each cell represents a pair of variables and the value represents the probability of their being statistically dependent under the inferred CrossCat model.

    ESTIMATE PAIRWISE DEPENDENCE PROBABILITY FROM dha SAVE TO dha_z.png;

![Dartmouth Atlas of Health z-matrix]({{ site.baseurl }}/assets/images/cs_dha/dha_z.png)

Notice that quality and cost show no dependence.  We can list the variables that share the most dependence with quality,

    ESTIMATE COLUMNS FROM dha ORDER BY DEPENDENCE PROBABILITY WITH qual_score LIMIT 10

|      column     | desc dependence probability with qual_score |
|-----------------|---------------------------------------------|
|    ami_score    |                  1.0                        |
|    qual_score   |                  1.0                        |
|   pneum_score   |                  1.0                        |
|    chf_score    |                  1.0                        |
|  mdcr_spnd_eqp  |                0.546875                     |
| eqp_copay_p_dcd |                0.546875                     |
|  mdcr_spnd_home |                  0.5                        |
| hha_visit_p_dcd |                  0.5                        |
|  mdcr_spnd_hspc |                0.34375                      |
|  pct_dths_hspc  |                0.34375                      |

It appears that the other `_score` variables and quality score are dependent related and Medicare expenditures, deaths, and days show a weak dependence probability with the quality score.

### Unwarranted variations on a per-town basis

Which hospitals are most anomalous? This is, which hospitals have the least probable quality scores given their other features?

    SELECT name,  PREDICTIVE PROBABILITY OF qual_score FROM dha ORDER BY PREDICTIVE PROBABILITY OF qual_score ASC LIMIT 10

|       name       | predictive probability qual_score |
|------------------|-----------------------------------|
|     Minot ND     |          0.0510907536854          |
|    Elyria OH     |           0.076834426233          |
|    Muncie IN     |          0.0832274336904          |
|    Chicago IL    |          0.0962254156258          |
|    McAllen TX    |           0.097379721139          |
|    El Paso TX    |          0.0986821560734          |
|    Monroe LA     |          0.0995746573259          |
| Lake Charles LA  |           0.110280616256          |
| New Brunswick NJ |           0.111456521019          |
|    Abilene TX    |           0.119637066987          |

<!--Here McAllen, Texas has a predictive probability orders of magnitide lower than the others. -->
Here McAllen, Texas has a predictive probability that is among the lowest. 
McAllen is a notoriously odd town when it comes to healthcare. In fact, the oddness of McAllen has been documented by the popular press ([The NewYorker](http://www.newyorker.com/reporting/2009/06/01/090601fa_fact_gawande), [CBS News](http://www.cbsnews.com/news/texas-town-at-center-of-healthcare-debate/) and [NPR](http://www.npr.org/blogs/health/2012/05/10/152417875/recalculating-the-health-bill-in-mcallen-texas)).

###Further information

The BayesDB-ready .csv and pre-computed models used here can be found in the `/examples` directory in the [BayesDB Github Repository](https://github.com/mit-probabilistic-computing-project/BayesDB/tree/master/examples/dha).

For more information about the Dartmouth Atlas of Health Care, [http://www.dartmouthatlas.org/](http://www.dartmouthatlas.org/).

#General Social Survey
+
##Responses to ~5500 demographic, behavioral and attitudinal questions by US residents.

According to economics research, homeowners engage more in community activities than renters. They are also more likely to vote, more likely to know the names of the local political representatives, and more likely to engage in civic activities  (DiPasquale, D., &amp; Glaeser, E. L., 1999). For this reason, homeowners have been labeled better citizens (DiPasquale, D., &amp; Glaeser, E. L., 1999; McCabe, 2013). 

We will revisit this analysis, making use of the General Social Survey (GSS). The GSS is a sociological survey that collects data on the demographic characteristics and attitudes of US residents. Among other things, it includes information on homeownership, moral attitudes, and criminal variables. We have started by loading a subset of the GSS data into BayesDB, created a btable, and analyzed the data. 

<!-- The General Social Survey (GSS) is a collection of demographic data as well as data on the social, moral, and political attitudes of Americans. 

We've already created a btable, `gss_pared`, from a subset of the full GSS dataset and analyzed the data.
-->

## Are homeowners more likely to vote?

First we'll check whether the homeowners of 2012, like their predecessors, are more likely to vote than renters. Since we're using the 2012 GSS we'll investigate the relationship between `vote08` and `dwelown` variables. `vote08` is a categorical variable, where `1` indicates that the respondent voted in the 2008 presidential election, while `0` indicates that the did not. `dwelown` is also a categorical variable where `1` indicates that the respondent owns their home, and `2` indicates that the respondent rents their home.

First, for homeowners (`dwelown=1`),

    PLOT SELECT vote08 FROM gss_pared where dwelown=1 SAVE TO votedwel_1.png;


<center>
<img src="{{ site.baseurl }}/assets/images/cs_gss/votedwel_1.png" class="img-med" alt="Vote variable plotted for homeowners">
</center>


and second, for renters (`dwelown=2`)

    PLOT SELECT vote08 FROM gss_pared where dwelown=2 SAVE TO votedwel_2.png;


<center>
<img src="{{ site.baseurl }}/assets/images/cs_gss/votedwel_2.png" class="img-med" alt="Vote variable plotted for homeowners">
</center>


We see that 75% of homeowners voted while only 50% of renters voted, confirming the previous finding.

## References

<p class='reference'>
[1] DiPasquale, D., &amp; Glaeser, E. L. (1999). Incentives and social capital: are homeowners better citizens?. Journal of urban Economics, 45(2), 354-384.
</p>
<p class='reference'>
[2] McCabe, B. J. (2013). Are Homeowners Better Citizens? Homeownership and Community Participation in the United States. Social forces, sos185.
</p>

##Further information

<!-- **FIXME: Where to get the .csv and models? (they are too big to put in a Github Repo)** -->

The full GSS dataset can be downloaded from their website, [here](http://www3.norc.org/GSS+Website/Download/).

#Early Childhood Longitudinal Study
+
##Relationships among demographic, social, and experiential variables and early achievement 

What kinds of early childhood environments are associated with improved educational outcomes? The Early Childhood Longitudinal Study (Kindergarten class) looks at a variety of variables---cultural, socioeconomic, and educational---as they relate to early proficiency in reading and mathematics. Research has found that sometimes simple things, such as the number of books in the home, have surprisingly strong associations with educational achivement (Evans, Kelley, Sikora, & Trieman, 2010). We investigate this finding using ECCLs dataset using BayesDB. 

Our first step is to look at which variables are probably dependent on each other. 

    ESTIMATE PAIRWISE DEPENDENCE PROBABILITY FROM eccls SAVE TO figures/dependence_probability_eccls.png;

![dependence probability for ECCLS]({{ site.baseurl }}/assets/images/cs_eccls/dependence_probability_eccls.png)

We can see that there are large blocks of variables that are probably dependent, as indicated by the dark blue, as well as variables that are probably independent of one another, as indicated by the white. The key variables for this analysis are the number of books in the home, `p1chlboo`, and outcomes. There are multiple outcome measures in the dataset, and we will focus on kindergarten performance on math and reading: `c1r4mtsc` and `c1r4rtsc`. To assess the probability of dependence, we can create a column list with only these variables, and print out BayesDBâ€™s estimate.

    CREATE COLUMN LIST p1chlboo, C1R4MTSC, C1R4RTSC FROM eccls AS books_achievement; 
    ESTIMATE PAIRWISE DEPENDENCE PROBABILITY FROM ecls FOR books_achievement;

|          |    p1chlboo    |    c1r4mtsc    |    c1r4rtsc    |
|----------+----------------|----------------|----------------|
| p1chlboo |      1.0       |      0.67      |      0.67      |
|----------+----------------|----------------|----------------|
| c1r4mtsc |      0.67      |      1.0       |      1.0       |
|----------+----------------|----------------|----------------|
| c1r4rtsc |      0.67      |      1.0       |      1.0       |


BayesDB has inferred that there is a modest probability of dependence between reading and math scores in kindergarten and the number of books in the home. 

Where does the number of books in the home lie relative to other possible predictors? To investigate this question, we can sort the variables based on the estimated probability of dependence with the target variable. Here we narrow our focus to just math scores, as that is the more interesting potential association. (It is pretty clear why having books may be related to reading scores, less so for math scores.)

    ESTIMATE COLUMNS FROM ecls ORDER BY DEPENDENCE PROBABILITY WITH C1R4MTSC LIMIT 15;

|  column  | dependence probability with c1r4mtsc |
|----------|--------------------------------------|
| c4r4rtsc |                 1.0                  |
| c1r4mtsc |                 1.0                  |
| c1r4rtsc |                 1.0                  |
| c4r4mtsc |            0.979166666667            |
| wkmomed  |            0.770833333333            |
| wkdaded  |            0.770833333333            |
| wkpov_r  |            0.770833333333            |
| p2homecm |            0.770833333333            |
| p1expect |                 0.75                 |
|   race   |                 0.75                 |
| p2safepl |            0.729166666667            |
| p1prmlng |            0.729166666667            |
| p2depres |                0.6875                |
| p1chlboo |            0.666666666667            |
| p1chlaud |            0.666666666667            |

After other math and reading scores, the variables with the highest probability of dependence are the mother and father's education levels and expectations for child's education level, `wkmomed`, `wkmomed`, `p1expect`, poverty level, `wkpov_r`, having a home computer, `p2homecm`, parents' race and language, `race` and `p1prmlng`, and whether a parent is depressed `p2depres`. For most of these, with the possible exception of having a computer, the relationship between these variables and achievement is clear. However, the association between having books in the home and achievement on math is less clear. Indeed, this is the finding of Evans et al. (2010). Across cultures, the association between having books in the home and educational outcomes such as the highest level of schooling completed is quite robust. 

Given that the estimated probability of dependence was not especially high, we might ask, what is the magnitude of the effect of having books? To investigate this question, we consider the predicted math achievement based on two possible scenarios: the case where there are no books in the home (`p1chlboo`=0), and the case where there are a very large number of books (`p1chlboo`=200). 

    SUMMARIZE SIMULATE C1R4MTSC FROM ecls GIVEN p1chlboo=0.00 TIMES 500
    
|           |    c1r4mtsc   |
|-----------|---------------|
|    type   |   continuous  |
|   count   |     500.0     |
|    mean   |  45.470765694 |
|    std    | 10.4608755698 |
|    min    | 20.4179280491 |
|    25%    | 38.3920501622 |
|    50%    | 45.0353491704 |
|    75%    | 51.5711362501 |
|    max    | 74.9516811658 |
|    mode   | 32.7555846674 |
| prob_mode |     0.002     |

    SUMMARIZE SIMULATE C1R4MTSC FROM ecls GIVEN p1chlboo=200.00 TIMES 500
    
|           |    c1r4mtsc   |
|-----------|---------------|
|    type   |   continuous  |
|   count   |     500.0     |
|    mean   | 52.0831026527 |
|    std    | 9.40720930617 |
|    min    | 23.8979427747 |
|    25%    | 45.8599243775 |
|    50%    | 51.9570269894 |
|    75%    | 58.2441761506 |
|    max    | 84.2324150938 |
|    mode   | 53.6594560334 |
| prob_mode |     0.002     |

If a household has no books at all, BayesDB predicts that a child will score ~45.5 on his or her kindergarten math exam. In constrast, if a household has 200 books, BayesDB predicts that he or she will score 52.1. That is a sizeable difference, more than half a standard deviation increase in expected math achievement, based on simply owning books. 
