---
title: Examples
tagline: 
layout: examples
---
# Dartmouth Atlas of Health

## Recording the cost structure, capacity and quality of care of US hospitals.

One of the main concerns in American health care is addressing *unwarranted variations* in quality: a disparity between the cost and outcomes of care. The cost-care disparity is well-documented mainly as a result of the Dartmouth Atlas of Health Care, a freely available dataset which

>...uses Medicare data to provide information and analysis about national, regional, and local markets, as well as hospitals and their affiliated physicians

Where initially, these findings were produced and reported by teams of researchers after months of work, we shall use BayesDB to verify these results in a few commands.

### Unwarranted variations in aggregate

First, we create a btable and load in pre-computed models,

    CREATE BTABLE dha FROM dha.csv;
    LOAD MODELS dha_models.pkl.gz INTO dha;

The first thing to do is to is get a general sense of the data by creating a column dependence probability matrix in which each cell represents a pair of variables and the value represents the probability of their being statistically dependent under the inferred CrossCat model. Here, we have zoomed in on two variables, the first related to medicare spending, and the second related to quality. 

    ESTIMATE PAIRWISE DEPENDENCE PROBABILITY FROM dha SAVE TO dha_z.png;

![Dartmouth Atlas of Health z-matrix]({{ site.baseurl }}/assets/images/cs_dha/dha_z_subset.png)

Dark areas represent variables with a high probability of dependence, light areas indicate a low probability of dependence. Notice that quality and cost show no dependence.  We can list the variables that share the most dependence with quality,

    ESTIMATE COLUMNS FROM dha ORDER BY DEPENDENCE PROBABILITY WITH qual_score LIMIT 10

|      column     | desc dependence probability with qual_score |
|-----------------|---------------------------------------------|
|    ami_score    |                  1.0                        |
|    qual_score   |                  1.0                        |
|   pneum_score   |                  1.0                        |
|    chf_score    |                  1.0                        |
|  mdcr_spnd_eqp  |                0.546875                     |
| eqp_copay_p_dcd |                0.546875                     |
|  mdcr_spnd_home |                  0.5                        |
| hha_visit_p_dcd |                  0.5                        |
|  mdcr_spnd_hspc |                0.34375                      |
|  pct_dths_hspc  |                0.34375                      |

It appears that the other `_score` variables and quality score are dependent related and Medicare expenditures, deaths, and days show a weak dependence probability with the quality score.

### Unwarranted variations on a per-town basis

Which hospitals are most anomalous? This is, which hospitals have the least probable quality scores given their other features?

    SELECT name,  PREDICTIVE PROBABILITY OF qual_score FROM dha ORDER BY PREDICTIVE PROBABILITY OF qual_score ASC LIMIT 10

|       name       | predictive probability qual_score |
|------------------|-----------------------------------|
|     Minot ND     |          0.0510907536854          |
|    Elyria OH     |           0.076834426233          |
|    Muncie IN     |          0.0832274336904          |
|    Chicago IL    |          0.0962254156258          |
|    McAllen TX    |           0.097379721139          |
|    El Paso TX    |          0.0986821560734          |
|    Monroe LA     |          0.0995746573259          |
| Lake Charles LA  |           0.110280616256          |
| New Brunswick NJ |           0.111456521019          |
|    Abilene TX    |           0.119637066987          |

<!--Here McAllen, Texas has a predictive probability orders of magnitide lower than the others. -->
Here McAllen, Texas has a predictive probability that is among the lowest. 
McAllen is a notoriously odd town when it comes to healthcare. In fact, the oddness of McAllen has been documented by the popular press ([The NewYorker](http://www.newyorker.com/reporting/2009/06/01/090601fa_fact_gawande), [CBS News](http://www.cbsnews.com/news/texas-town-at-center-of-healthcare-debate/) and [NPR](http://www.npr.org/blogs/health/2012/05/10/152417875/recalculating-the-health-bill-in-mcallen-texas)).

###Further information

The BayesDB-ready .csv and pre-computed models used here can be found in the `/examples` directory in the [BayesDB Github Repository](https://github.com/mit-probabilistic-computing-project/BayesDB/tree/master/examples/dha).

For more information about the Dartmouth Atlas of Health Care, [http://www.dartmouthatlas.org/](http://www.dartmouthatlas.org/).

#General Social Survey

##Responses to ~5500 demographic, behavioral and attitudinal questions by US residents.

The General Social Survey is conducted annually to assess the demographics and attitudes of U.S. residents. Questions span  current housing situations, religion, voting, and positions on social issues. It is a very interesting source of information about how demographics and attitudes covary in the U.S. We are going to use BayesDB to explore this data, first to simply explore some relatively familiar variables for which we might have strong intuitions, second to assess BayesDB's inferences against findings from other research, and finally to generate hypothetical survey responses. 

## What variables are associated with born-again experiences?

Religion is one topic for which we have strong intuitions, and it therefore makes a good intuitive assessment the quality of BayesDB's inferences. The GSS contains a number of questions related to religion. Here, we focus on people's responses to the question of whether they have had a born-again experience. This is a feature of Christian religions, and especially Evangelical religions. We begin by ordering the variables based on the inferred dependence probability. 

    ESTIMATE COLUMNS FROM gss_pared ORDER BY DEPENDENCE PROBABILITY WITH reborn LIMIT 10

|  column  | dependence probability with reborn |
|----------|------------------------------------|
| savesoul |                1.0                 |
|  reborn  |                1.0                 |
| evolved  |                1.0                 |
|   god    |           0.979166666667           |
|  bible   |           0.979166666667           |
| bigbang  |           0.979166666667           |
|  prayer  |               0.9375               |
| postlife |               0.9375               |
| homosex  |           0.916666666667           |
|  grass   |           0.895833333333           |

We can see that a number of variables are inferred to be probably dependent. These include whether one tries to convince others to accept Jesus Christ, believes that humans evolved from animals, believes in God, believes the bible is the word of God, believes in the Big Bang, prays, believes in the afterlife, believes homosexuality is wrong, and believes that marijuana should be legalized. These inferred dependencies span a variety of domains, from purely religious issues to morals, science, and public policy. With the possible exception of the legalization of marijuana, these inferences are quite consonant with intuition. 

We can take a closer look at the relationship between born-again experiences and beliefs about the legalization of marijuana. 

    PLOT SELECT reborn, grass FROM gss_pared SAVE TO figures/select_reborn_grass.png

<center>
<img src="{{ site.baseurl }}/assets/images/cs_gss/select_reborn_grass.png" class="img-med" alt="Born again and Marijuana">
</center>

We can see that if one favors legalization, it is highly probable that one has not had a born-again experience. Interestingly, people who do not favor legalization may or may not have had a born-again experience. Taking a closer look at marijuana legalization, 

    ESTIMATE COLUMNS FROM gss_pared ORDER BY DEPENDENCE PROBABILITY WITH grass LIMIT 10
    
|  column  | dependence probability with grass |
|----------|-----------------------------------|
|  grass   |                1.0                |
| homosex  |           0.979166666667          |
| suicide1 |           0.958333333333          |
| letdie1  |               0.9375              |
|  prayer  |           0.916666666667          |
| savesoul |           0.895833333333          |
|  reborn  |           0.895833333333          |
| evolved  |           0.895833333333          |
|   god    |               0.875               |
|  bible   |               0.875               |

we see a largely complementary set of results. The first three variables are related to moral issues: homosexuality and whether suicide should be allowable under different circumstances. The remaining variables are religious, with the exception of the issue of evolution, which we know to be strongly related to religous beliefs. Taken together, the results are in close accord with intuition.

## Are homeowners more likely to vote?

Turning to a documented finding, economics research has shown that homeowners engage more in community activities than renters. They are also more likely to vote, more likely to know the names of the local political representatives, and more likely to engage in civic activities  (DiPasquale, D., &amp; Glaeser, E. L., 1999). For this reason, homeowners have been labeled better citizens (DiPasquale, D., &amp; Glaeser, E. L., 1999; McCabe, 2013). 

First we'll check whether the homeowners of 2012 are more likely to vote than renters. Since we're using the 2012 GSS we'll investigate the relationship between `vote08` and `dwelown` variables. `vote08` is a categorical variable, where `1` indicates that the respondent voted in the 2008 presidential election, while `0` indicates that the did not. `dwelown` is also a categorical variable where `1` indicates that the respondent owns their home, and `2` indicates that the respondent rents their home.

First, for homeowners (`dwelown=1`),

    PLOT SELECT vote08 FROM gss_pared where dwelown=1 SAVE TO votedwel_1.png;


<center>
<img src="{{ site.baseurl }}/assets/images/cs_gss/votedwel_1.png" class="img-med" alt="Vote variable plotted for homeowners">
</center>


and second, for renters (`dwelown=2`)

    PLOT SELECT vote08 FROM gss_pared where dwelown=2 SAVE TO votedwel_2.png;

<center>
<img src="{{ site.baseurl }}/assets/images/cs_gss/votedwel_2.png" class="img-med" alt="Vote variable plotted for homeowners">
</center>

We see that 75% of homeowners voted while only 50% of renters voted, confirming the previous finding.

## Generating hypothetical survey responses

An interesting feature of BayesDB is the ability to simulate hypothetical data based on what it has learned from the observed data. Here we use this feature to assess the quality of BayesDBs predictions. We focus on a subset of the variables discussed above:

    SIMULATE reborn, savesoul, bible, evolved FROM gss_pared TIMES 10

| reborn   | savesoul |     bible     | evolved | 
------------------------------------------------|
|   No     |   No     | Inspired word |    T    |
|   No     |   No     | Ancient book  |    T    |
|   No     |   No     | Ancient book  |    T    |
|   No     |   No     | Inspired word |    T    |
|   No     |   No     | Ancient book  |    T    |
|   No     |   Yes    | Ancient book  |    T    |
|   No     |   Yes    | Actual word   |    F    |
|   Yes    |   No     | Inspired word |    T    |
|   Yes    |   Yes    | Actual word   |    F    |
|   Yes    |   Yes    | Actual word   |    F    |

We have sorted the simulated responses based on the first two columns. At the top are cases where the simulated respondant did not have a born-again experience and has not encouraged someone to accept Jesus. For this group, we see strong consensus responses on the other two questions: they believe the bible is not the actual word of God and that humans evolved from animals. In contrast, the simluated respondants who had had born-again experiences and had encouraged someone to accept Jesus responded that the bible is the actual word of God and that humans did not evolved. These responses accord with intuition about how real people might respond. 

<!-- SAVE THIS, IT IS EXTRA FODDER
    SIMULATE reborn, savesoul, bible, evolved, vote08, dwelown FROM gss_pared GIVEN reborn=1, savesoul=1 TIMES 10

| reborn | savesoul |     bible     | evolved | vote08 | dwelown |
|--------|----------|---------------|---------|--------|---------|
|  Yes   |   Yes    | Inspired word |   No    |  Yes   |  Rent   |
|  Yes   |   Yes    | Inspired word |   Yes   |  No    |  Own    |
|  Yes   |   Yes    | Ancient book  |   Yes   |  Yes   |  Own    |
|  Yes   |   Yes    | Actual word   |   No    |  Yes   |  Own    |
|  Yes   |   Yes    | Inspired word |   No    |  Yes   |  Own    |
|  Yes   |   Yes    | Inspired word |   No    |  Yes   |  Own    |
|  Yes   |   Yes    | Inspired word |   No    |  Yes   |  Own    |
|  Yes   |   Yes    | Actual word   |   No    |  Yes   |  Rent   |
|  Yes   |   Yes    | Inspired word |   No    |  Yes   |  Rent   |
|  Yes   |   Yes    | Ancient book  |   No    |  No    |  Rent   |

    SIMULATE reborn, savesoul, bible, evolved, vote08, dwelown FROM gss_pared GIVEN reborn=2, savesoul=2 TIMES 10

| reborn | savesoul |     bible     | evolved |  vote08    | dwelown |
|--------|----------|---------------|---------|------------|---------|
|  No    |   No     | Inspired word |   Yes   |    No      |  Rent   |
|  No    |   No     | Actual word   |   No    |    No      |  Own    |
|  No    |   No     | Ancient book  |   Yes   | Ineligible |  Own    |
|  No    |   No     | Ancient book  |   Yes   |    No      |  Own    |
|  No    |   No     | Inspired word |   Yes   |    Yes     |  Own    |
|  No    |   No     | Ancient book  |   Yes   |    No      |  Rent   |
|  No    |   No     | Inspired word |   Yes   |    No      |  Own    |
|  No    |   No     | Inspired word |   No    |    Yes     |  Rent   |
|  No    |   No     | Ancient book  |   Yes   |    No      |  Own    |
|  No    |   No     | Inspired word |   No    |    Yes     |  Own    |

The top table shows simulated respondants who had born-again experiences and had encouraged someone to accept Jesus. These simulated respondants tend to believe the bible is either inspired text or the word of god, that humans have not evolved from animals, voted in 2008, and may rent or own. The bottom table shows simulated respondants who had not had born-again experiences and had not encouraged someone to accept Jesus. In contrast with the top table, these simulated respondants tend to believe the bible is either an ancient book or inspired word, and tend to believe in evolution. They also were less likely to vote, but showed similar tendencies toward renting or owning. 
-->

Taken together, these three demonstrations show that BayesDB captures intuitively compelling structure in the data, and validates one inferences against findings in the literature. 

## References

<p class='reference'>
[1] DiPasquale, D., &amp; Glaeser, E. L. (1999). Incentives and social capital: are homeowners better citizens?. Journal of urban Economics, 45(2), 354-384.
</p>
<p class='reference'>
[2] McCabe, B. J. (2013). Are Homeowners Better Citizens? Homeownership and Community Participation in the United States. Social forces, sos185.
</p>

##Further information

<!-- **FIXME: Where to get the .csv and models? (they are too big to put in a Github Repo)** -->

The full GSS dataset can be downloaded from their website, [here](http://www3.norc.org/GSS+Website/Download/).

#Early Childhood Longitudinal Study

##Relationships among demographic, social, and experiential variables and early achievement 

What kinds of early childhood environments are associated with improved educational outcomes? The Early Childhood Longitudinal Study (Kindergarten class) looks at a variety of variables---cultural, socioeconomic, and educational---as they relate to early proficiency in reading and mathematics. Research has found that sometimes simple things, such as the number of books in the home, have surprisingly strong associations with educational achievement (Evans, Kelley, Sikora, & Trieman, 2010). We investigate this finding using ECLs dataset using BayesDB. 

Our first step is to look at which variables are related to educational outcomes. Here, we will focus on children's kindergarten math scores as our outcome of interest.

    ESTIMATE COLUMNS FROM ecls ORDER BY DEPENDENCE PROBABILITY WITH C1R4MTSC LIMIT 15;

|  column  | dependence probability with c1r4mtsc |
|----------|--------------------------------------|
| c4r4rtsc |                 1.0                  |
| c1r4mtsc |                 1.0                  |
| c1r4rtsc |                 1.0                  |
| c4r4mtsc |            0.979166666667            |
| wkmomed  |            0.770833333333            |
| wkdaded  |            0.770833333333            |
| wkpov_r  |            0.770833333333            |
| p2homecm |            0.770833333333            |
| p1expect |                 0.75                 |
|   race   |                 0.75                 |
| p2safepl |            0.729166666667            |
| p1prmlng |            0.729166666667            |
| p2depres |                0.6875                |
| p1chlboo |            0.666666666667            |
| p1chlaud |            0.666666666667            |

After other math and reading scores, there are a collection of variables whose relationship to outcomes is rather intuitive. These include the mother and father's education levels and expectations for child's education level, `wkmomed`, `wkmomed`, `p1expect`, poverty level, `wkpov_r`, parents' race and language, `race` and `p1prmlng`, whether a parent is depressed `p2depres`, and whether there is a computer in the home, `p2homecm`. However, for a small group of findings, it is less clear how they are related to math achievement. These include the number of books in the house, `p1chlboo`, and the number of CDs and tapes in the house, `p1chlaud`. 

To investigate this further, we can explore how different values of each variable affect math scores. We will simulate predicted math scores given very small numbers of CDs and books (zero in each case), and given relatively large numbers of CDs and books (100 and 200, respectively). We have superimposed each pair of figures to compare the results, where the light blue represents zero and the gray represents large numbers of tapes and CDS or books.

    PLOT SIMULATE C1R4MTSC FROM ecls GIVEN p1chlaud=0.00 TIMES 500 Save to simulate_C1R4MTSC_p1chlaud=0.png
    PLOT SIMULATE C1R4MTSC FROM ecls GIVEN p1chlaud=100.00 TIMES 500 Save to simulate_C1R4MTSC_p1chlaud=100.png
    
<center>
<img src="{{ site.baseurl }}/assets/images/cs_eccls/ecls_comparison_cds.png" class="img-med" alt="Math outcomes given number of tapes">
</center>
    
    PLOT SIMULATE C1R4MTSC FROM ecls GIVEN p1chlboo=0.00 TIMES 500 Save to simulate_C1R4MTSC_p1chlboo=0.png
    PLOT SIMULATE C1R4MTSC FROM ecls GIVEN p1chlboo=200.00 TIMES 500 Save to simulate_C1R4MTSC_p1chlboo=200.png

<center>
<img src="{{ site.baseurl }}/assets/images/cs_eccls/ecls_comparison_books.png" class="img-med" alt="Math outcomes given number of books">
</center>

Larger numbers of tapes and CDs and larger numbers of books are both associated with higher scores. Indeed, our finding regarding books agrees with previous research showing that children that grow up around large numbers of books is related to educational performance (Evans et al., 2010). 

## References

<p class='reference'>
[1] Evans, M. D. R., Kelley, J., Sikora, J. &amp; Treiman, D. J. (2010). Family scholarly culture and educational success: Books and schooling in 27 nations. Research in Social Stratification and Mobility, 28(2), 171-197.
</p>
