---
title: Examples
tagline: 
layout: examples
---
# Dartmouth Atlas of Health
## Recording the cost structure, capacity and quality of care of US hospitals.

One of the main concerns in American health care is addressing *unwarranted variations* in quality: a disparity between the cost and outcomes of care. The cost-care disparity is well-documented mainly as a result of the Dartmouth Atlas of Health Care, a freely available dataset which

>...uses Medicare data to provide information and analysis about national, regional, and local markets, as well as hospitals and their affiliated physicians

Where initially, these findings were produced and reported by teams of researchers after months of work, we shall use BayesDB to verify these results in a few commands.

### Unwarranted variations in aggregate

First, we create a btable and load in pre-computed models,

    CREATE BTABLE dha FROM dha.csv;
    LOAD MODELS dha_models.pkl.gz INTO dha;

The first thing to do is to is get a general sense of the data by creating a column dependence probability matrix in which each cell represents a pair of variables and the value represents the probability of their being statistically dependent under the inferred CrossCat model.

    ESTIMATE PAIRWISE DEPENDENCE PROBABILITY FROM dha SAVE TO dha_z.png;

![Dartmouth Atlas of Health z-matrix]({{ site.baseurl }}/assets/images/cs_dha/dha_z.png)

Notice that quality and cost show no dependence.  We can list the variables that share the most dependence with quality,

    ESTIMATE COLUMNS FROM dha ORDER BY DEPENDENCE PROBABILITY WITH qual_score LIMIT 10

|      column     | desc dependence probability with qual_score |
|-----------------|---------------------------------------------|
|    ami_score    |                  1.0                        |
|    qual_score   |                  1.0                        |
|   pneum_score   |                  1.0                        |
|    chf_score    |                  1.0                        |
|  mdcr_spnd_eqp  |                0.546875                     |
| eqp_copay_p_dcd |                0.546875                     |
|  mdcr_spnd_home |                  0.5                        |
| hha_visit_p_dcd |                  0.5                        |
|  mdcr_spnd_hspc |                0.34375                      |
|  pct_dths_hspc  |                0.34375                      |

It appears that the other `_score` variables and quality score are dependent related and Medicare expenditures, deaths, and days show a weak dependence probability with the quality score.

### Unwarranted variations on a per-town basis

Which hospitals are most anomalous? This is, which hospitals have the least probable quality scores given their other features?

    SELECT name,  PREDICTIVE PROBABILITY OF qual_score FROM dha ORDER BY PREDICTIVE PROBABILITY OF qual_score ASC LIMIT 10

<!--
| row_id |        name       | predictive probability qual_score |
|--------|-------------------|-----------------------------------|
|  161   |     McAllen TX    |         0.000305809830999         |
|   79   |     Elyria OH     |          0.0386015426914          |
|  171   |      Minot ND     |          0.0408746077354          |
|  152   |     Lubbock TX    |          0.0686783885467          |
|  185   |  New Brunswick NJ |          0.0817273108102          |
|   94   |     Fresno CA     |          0.0872660495903          |
|  175   |     Monroe LA     |          0.0880447645968          |
|  124   |     Jackson TN    |          0.0901135638775          |
|  239   | San Bernardino CA |          0.0923877470568          |
|   76   |     El Paso TX    |           0.094225198692          |
-->

|       name       | predictive probability qual_score |
|------------------|-----------------------------------|
|     Minot ND     |          0.0510907536854          |
|    Elyria OH     |           0.076834426233          |
|    Muncie IN     |          0.0832274336904          |
|    Chicago IL    |          0.0962254156258          |
|    McAllen TX    |           0.097379721139          |
|    El Paso TX    |          0.0986821560734          |
|    Monroe LA     |          0.0995746573259          |
| Lake Charles LA  |           0.110280616256          |
| New Brunswick NJ |           0.111456521019          |
|    Abilene TX    |           0.119637066987          |

<!--Here McAllen, Texas has a predictive probability orders of magnitide lower than the others. -->
Here McAllen, Texas has a predictive probability that is among the lowest. 
McAllen is a notoriously odd town when it comes to healthcare. In fact, the oddness of McAllen has been documented by the popular press ([The NewYorker](http://www.newyorker.com/reporting/2009/06/01/090601fa_fact_gawande), [CBS News](http://www.cbsnews.com/news/texas-town-at-center-of-healthcare-debate/) and [NPR](http://www.npr.org/blogs/health/2012/05/10/152417875/recalculating-the-health-bill-in-mcallen-texas)).

###Further information

The BayesDB-ready .csv and pre-computed models used here can be found in the `/examples` directory in the [BayesDB Github Repository](https://github.com/mit-probabilistic-computing-project/BayesDB/tree/master/examples/dha).

For more information about the Dartmouth Atlas of Health Care, [http://www.dartmouthatlas.org/](http://www.dartmouthatlas.org/).

#General Social Survey
##Responses to ~5500 demographic, behavioral and attitudinal questions by US residents.

According to economics research, homeowners engage more in community activities than renters. They are also more likely to vote, more likely to know the names of the local political representatives, and more likely to engage in civic activities  (DiPasquale, D., &amp; Glaeser, E. L., 1999). For this reason, homeowners have been labeled better citizens (DiPasquale, D., &amp; Glaeser, E. L., 1999; McCabe, 2013). 

We will revisit this analysis, making use of the General Social Survey (GSS). The GSS is a sociological survey that collects data on the demographic characteristics and attitudes of US residents. Among other things, it includes information on homeownership, moral attitudes, and criminal variables. We have started by loading a subset of the GSS data into BayesDB, created a btable, and analyzed the data. 

<!-- The General Social Survey (GSS) is a collection of demographic data as well as data on the social, moral, and political attitudes of Americans. 

We've already created a btable, `gss_pared`, from a subset of the full GSS dataset and analyzed the data.
-->

## Are homeowners more likely to vote?

First we'll check whether the homeowners of 2012, like their predecessors, are more likely to vote than renters. Since we're using the 2012 GSS we'll investigate the relationship between `vote08` and `dwelown` variables. `vote08` is a categorical variable, where `1` indicates that the respondent voted in the 2008 presidential election, while `0` indicates that the did not. `dwelown` is also a categorical variable where `1` indicates that the respondent owns their home, and `2` indicates that the respondent rents their home.

First, for homeowners (`dwelown=1`),

    PLOT SELECT vote08 FROM gss_pared where dwelown=1 SAVE TO votedwel_1.png;

<!-- |            |      vote08     |
|    type    |   multinomial   |
|   count    |       800       |
|   unique   |        3        |
|   mode1    |        1        |
|   mode2    |        2        |
|   mode3    |        3        |
| prob_mode1 |  0.752475247525 |h
| prob_mode2 |  0.180693069307 |
| prob_mode3 | 0.0569306930693 | -->

<center>
<img src="{{ site.baseurl }}/assets/images/cs_gss/votedwel_1.png" class="img-med" alt="Vote variable plotted for homeowners">
</center>
<!-- ![Vote variable plotted for homeowners]({{ site.baseurl }}/assets/images/cs_gss/votedwel_1.png) -->

and second, for renters (`dwelown=2`)

    PLOT SELECT vote08 FROM gss_pared where dwelown=2 SAVE TO votedwel_2.png;

<!-- |            |     vote08     |
|    type    |  multinomial   |
|   count    |      466       |
|   unique   |       3        |
|   mode1    |       1        |
|   mode2    |       2        |
|   mode3    |       3        |
| prob_mode1 | 0.501057082452 |
| prob_mode2 | 0.353065539112 |
| prob_mode3 | 0.131078224101 | -->

<center>
<img src="{{ site.baseurl }}/assets/images/cs_gss/votedwel_2.png" class="img-med" alt="Vote variable plotted for homeowners">
</center>

<!-- ![Vote variable plotted for renters]({{ site.baseurl }}/assets/images/cs_gss/votedwel_2.png) -->

We see that 75% of homeowners voted while only 50% of renters voted, confirming the previous finding.

## References

<p class='reference'>
[1] DiPasquale, D., &amp; Glaeser, E. L. (1999). Incentives and social capital: are homeowners better citizens?. Journal of urban Economics, 45(2), 354-384.
</p>
<p class='reference'>
[2] McCabe, B. J. (2013). Are Homeowners Better Citizens? Homeownership and Community Participation in the United States. Social forces, sos185.
</p>
<!-- <p class='reference'><a id='ref3'></a>
[3] Aaronson, D. (2000). A Note on the Benefits of Homeownership. Journal of Urban Economics, 47(3), 356-369.
</p> -->

##Further information

<!-- **FIXME: Where to get the .csv and models? (they are too big to put in a Github Repo)** -->

The full GSS dataset can be downloaded from their website, [here](http://www3.norc.org/GSS+Website/Download/).

#Early Childhood Longitudinal Study
##Relationships among demographic, social, and experiential variables and early achievement 

What kinds of early educational experiences lead to the best outcomes for children? The Early Childhood Longitudinal Study (Kindergarten class) looks at a variety of variables---cultural, socioeconomic, and educational---as they relate to early proficiency in reading and mathematics. Research has found that pre-kindergarten programs are among the best early experiences in terms of improving school readiness (at least as it relates to math and reading at the beginning of kindergarten; Magnuson, Ruhm, & Waldfogel, 2007). 


Our first step is to look at which variables are probably dependent on each other. 

    ESTIMATE PAIRWISE DEPENDENCE PROBABILITY FROM eccls SAVE TO figures/dependence_probability_eccls.png;

![dependence probability for ECCLS]({{ site.baseurl }}/assets/images/cs_eccls/dependence_probability_eccls.png)

We can see that there are large blocks of variables that are probably dependent, as indicated by the dark blue, as well as variables that are probably independent of one another, as indicated by the white. The key variables in for this analysis are participation in a pre-K program, `prekindergarten`, and outcomes. There are multiple outcome measures in the dataset, and we will focus on kindergarten performance on math and reading: `c1r4mtsc` and `c1r4rtsc`. To assess the probability of dependence, we can create a column list with only these variables, and print out BayesDB’s estimate.

    CREATE COLUMN LIST prekindergarten, C1R4MTSC, C1R4RTSC FROM eccls AS preK_outcomes; 
    ESTIMATE PAIRWISE DEPENDENCE PROBABILITY FROM eccls FOR preK_outcomes;

|                 | prekindergarten |    c1r4mtsc    |    c1r4rtsc    |
|-----------------|-----------------|----------------|----------------|
| prekindergarten |       1.0       | 0.416666666667 | 0.416666666667 |
|     c1r4mtsc    |  0.416666666667 |      1.0       |      1.0       |
|     c1r4rtsc    |  0.416666666667 |      1.0       |      1.0       |

Interestingly, BayesDB suggests that there is not a particularly high probability of dependence between pre-K and math and reading skills. 

To test the hypothesis that pre-K is most strongly predictive of performance, we need to contrast with other alternatives such as staying at home with a parent, relative, or going to nursery school: `parentalcare`, `relativecare`, and `nurseryschool`, respectively. Focusing on the outcome variables of interest, namely math and reading performance, we order the other variables in terms of the probability of dependence.

    ESTIMATE COLUMNS FROM eccls ORDER BY DEPENDENCE PROBABILITY WITH C1R4MTSC LIMIT 65;

|      column      | dependence probability with c1r4mtsc |
|------------------|--------------------------------------|
|     c4r4rtsc     |                 1.0                  |
|     c1r4mtsc     |                 1.0                  |
|     c1r4rtsc     |                 1.0                  |
|     c4r4mtsc     |            0.979166666667            |
|     wkmomed      |            0.770833333333            |
|     wkdaded      |            0.770833333333            |
|     wkpov_r      |            0.770833333333            |
|     p2homecm     |            0.770833333333            |
|     p1expect     |                 0.75                 |
|       race       |                 0.75                 |
|     p2safepl     |            0.729166666667            |
|     p1prmlng     |            0.729166666667            |
|     p2depres     |                0.6875                |
|     p1chlboo     |            0.666666666667            |
|     p1chlaud     |            0.666666666667            |
|     p1hfamil     |            0.645833333333            |
|     p1nature     |            0.645833333333            |
|     p1hparnt     |            0.645833333333            |
|     p1chlpic     |            0.645833333333            |
|     p1readbo     |            0.645833333333            |
|     p1helpar     |                0.625                 |
|     p1games      |                0.625                 |
|     p1build      |                0.625                 |
|     p1singso     |            0.604166666667            |
|     p1letter     |            0.604166666667            |
|     p1sport      |            0.604166666667            |
|     p1count      |            0.604166666667            |
|     p1numsib     |            0.583333333333            |
|     p1verbal     |            0.583333333333            |
|     p1pencil     |            0.583333333333            |
|     p1htotal     |            0.583333333333            |
|     p1share      |            0.583333333333            |
|     p1still      |            0.583333333333            |
|     p1tellst     |            0.583333333333            |
|     s2crime      |                 0.5                  |
|     s2drugs      |                 0.5                  |
|     s2gangs      |                 0.5                  |
|     s2vcancy     |                 0.5                  |
|     s2litter     |                 0.5                  |
|     s2trffic     |                 0.5                  |
|     s2vlence     |                 0.5                  |
|     s2tnsion     |                 0.5                  |
|     t4extern     |            0.479166666667            |
|     t4contro     |            0.479166666667            |
|     t1contro     |            0.479166666667            |
|     cs_type2     |            0.479166666667            |
|     cregion      |            0.479166666667            |
|     t1extern     |            0.458333333333            |
|     p1nprek      |                0.4375                |
|   parentalcare   |                0.4375                |
|     p1csamek     |                0.4375                |
| othernonparental |                0.4375                |
|   relativecare   |                0.4375                |
|     p1cever      |                0.4375                |
|  nurseryschool   |                0.4375                |
|    preschool     |                0.4375                |
|     p1cprek      |                0.4375                |
|     p1primpk     |                0.4375                |
|     p1rprek      |                0.4375                |
|  daycarecenter   |                0.4375                |
|    headstart     |            0.416666666667            |
| prekindergarten  |            0.416666666667            |
|     p1hsever     |            0.416666666667            |
|     p1hsprek     |            0.416666666667            |
|     p1cprgpk     |            0.416666666667            |

    ESTIMATE COLUMNS FROM eccls ORDER BY DEPENDENCE PROBABILITY WITH C1R4RTSC LIMIT 65;

|      column      | dependence probability with c1r4rtsc |
|------------------|--------------------------------------|
|     c4r4rtsc     |                 1.0                  |
|     c1r4mtsc     |                 1.0                  |
|     c1r4rtsc     |                 1.0                  |
|     c4r4mtsc     |            0.979166666667            |
|     wkmomed      |            0.770833333333            |
|     wkdaded      |            0.770833333333            |
|     wkpov_r      |            0.770833333333            |
|     p2homecm     |            0.770833333333            |
|     p1expect     |                 0.75                 |
|       race       |                 0.75                 |
|     p2safepl     |            0.729166666667            |
|     p1prmlng     |            0.729166666667            |
|     p2depres     |                0.6875                |
|     p1chlboo     |            0.666666666667            |
|     p1chlaud     |            0.666666666667            |
|     p1hfamil     |            0.645833333333            |
|     p1nature     |            0.645833333333            |
|     p1hparnt     |            0.645833333333            |
|     p1chlpic     |            0.645833333333            |
|     p1readbo     |            0.645833333333            |
|     p1helpar     |                0.625                 |
|     p1games      |                0.625                 |
|     p1build      |                0.625                 |
|     p1singso     |            0.604166666667            |
|     p1letter     |            0.604166666667            |
|     p1sport      |            0.604166666667            |
|     p1count      |            0.604166666667            |
|     p1numsib     |            0.583333333333            |
|     p1verbal     |            0.583333333333            |
|     p1pencil     |            0.583333333333            |
|     p1htotal     |            0.583333333333            |
|     p1share      |            0.583333333333            |
|     p1still      |            0.583333333333            |
|     p1tellst     |            0.583333333333            |
|     s2crime      |                 0.5                  |
|     s2drugs      |                 0.5                  |
|     s2gangs      |                 0.5                  |
|     s2vcancy     |                 0.5                  |
|     s2litter     |                 0.5                  |
|     s2trffic     |                 0.5                  |
|     s2vlence     |                 0.5                  |
|     s2tnsion     |                 0.5                  |
|     t4extern     |            0.479166666667            |
|     t4contro     |            0.479166666667            |
|     t1contro     |            0.479166666667            |
|     cs_type2     |            0.479166666667            |
|     cregion      |            0.479166666667            |
|     t1extern     |            0.458333333333            |
|     p1nprek      |                0.4375                |
|   parentalcare   |                0.4375                |
|     p1csamek     |                0.4375                |
| othernonparental |                0.4375                |
|   relativecare   |                0.4375                |
|     p1cever      |                0.4375                |
|  nurseryschool   |                0.4375                |
|    preschool     |                0.4375                |
|     p1cprek      |                0.4375                |
|     p1primpk     |                0.4375                |
|     p1rprek      |                0.4375                |
|  daycarecenter   |                0.4375                |
|    headstart     |            0.416666666667            |
| prekindergarten  |            0.416666666667            |
|     p1hsever     |            0.416666666667            |
|     p1hsprek     |            0.416666666667            |
|     p1cprgpk     |            0.416666666667            |

After other math and reading scores, the most probably dependent variables are those related to parental education and poverty, followed by the skills that parents value, the resources at home, and the activities they engage in with their children. Relevant to our question, the probability of dependence between preK and our math and reading outcomes is not stronger than for other forms of care, which disagrees with the previous finding.

If we focus on pre-k versus parental care, we can get a better sense of what the relationships are. `prekindergarten` and `parentalcare` are each binary variables, where 1 indicates true and 0 indicates false. `c1r4rtsc` is a continuous variable representing the child’s score on the exam. We create a column list with just these three variables, then plot the data.

    CREATE COLUMN LIST prekindergarten, C1R4MTSC, parentalcare FROM eccls AS math_prek_parent;
    PLOT SELECT math_prek_parent FROM eccls SAVE TO figures/select_math_prek_parent.png;

<center>
<img src="{{ site.baseurl }}/assets/images/cs_eccls/select_math_prek_parent.png" class="img-med" alt="pre-k versus parental care">
</center>

One can see that there is some difference in math scores between the `parentalcare=1` and `prekindergarten=1`. The difference is not huge, consistent with Magnuson et al.’s finding of a 4 point difference. Turning from the observed data to BayesDB’s predictions, we can see that the difference in the empirical distributions is not as apparent in the predictive distributions.

    PLOT SIMULATE math_prek_parent FROM eccls TIMES 500 SAVE TO figures/simulate_math_prek_parent.png;

<center>
<img src="{{ site.baseurl }}/assets/images/cs_eccls/simulate_math_prek_parent.png" class="img-med" alt="simulated pre-k versus parental care">
</center>

Looking at BayesDB’s predictions, we can see why the probability of dependence is not especially high. Although a small difference remains in the means, the main difference in the predictive distributions is that pre-K skews scores higher.

Previous research argued that pre-K programs were best based on regression analyses in which factors like parental and neighborhood attributes were taken into account. Intuitively, one could imagine that the effects of pre-K would be most pronounced in kids who have the least resources, a finding that Magnuson et al. (2007) report. Focusing on the children whose mothers have relatively little education and live in the least safe neighborhoods, we can investigate that question. Because there are relatively few datapoints that represent any specific situation, we look at the simulated data. These bake-in the uncertainty associated with the limited observed data, but allow generating enough samples to make inferences, should they be supported.

    plot simulate c1r4mtsc from eccls given p2safepl=1.00 and prekindergarten=1.00 and wkmomed=2.00 times 500 save to figures/simulate_c1r4mtsc_prek.png;

<center>
<img src="{{ site.baseurl }}/assets/images/cs_eccls/simulate_c1r4mtsc_prek.png" class="img-med" alt="simulated data">
</center>

    plot simulate c1r4mtsc from eccls given p2safepl=1.00 and parentalcare=1.00 and wkmomed=2.00 times 500 save to figures/simulate_c1r4mtsc_parental.png;

<center>
<img src="{{ site.baseurl }}/assets/images/cs_eccls/simulate_c1r4mtsc_parental.png" class="img-med" alt="simulated data">
</center>

It appears that attending pre-K skews the distribution slightly upward. We can inspect summary statistics of the simulated distribution.

    summarize simulate c1r4mtsc from eccls given p2safepl=1.00 and prekindergarten=1.00 and wkmomed=2.00 times 1000;

|            |    c1r4mtsc   |
|------------|---------------|
|    type    |   continuous  |
|   count    |     1000.0    |
|    mean    | 45.2458640181 |
|    std     | 9.28436570631 |
|    min     | 18.8392769098 |
|    25%     | 38.9974312976 |
|    50%     | 45.0942152006 |
|    75%     | 51.1673499342 |
|    max     | 82.1694368985 |
|   mode     | 55.3516235201 |
| prob_mode  |     0.001     |

    summarize simulate c1r4mtsc from eccls given p2safepl=1.00 and parentalcare=1.00 and wkmomed=2.00 times 1000;

|            |    c1r4mtsc   |
|------------|---------------|
|    type    |   continuous  |
|   count    |     500.0     |
|    mean    | 43.7200395167 |
|    std     | 9.50747027352 |
|    min     | 12.9429919217 |
|    25%     | 37.2475794971 |
|    50%     | 43.2027073986 |
|    75%     | 49.7351282305 |
|    max     |  78.477569055 |
|   mode     |  46.537475471 |
| prob_mode  |     0.001     |

The summary statistics confirm a slight trend toward pre-K increasing math scores. Notably, the difference is more evident in the shape of the distribution than the mean. Relative to other relationships in the data, for example, the dependence between math scores and owning books, this effect is rather small. Nevertheless, these analyses support the original findings, while adding some nuance--the effects of pre-K are not overwhelming, even for children who are most disadvantaged. 
